<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>3D AR Cube Fix</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        .arjs-loader {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-family: -apple-system, sans-serif;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">Наведите камеру на горизонтальную поверхность...</div>
    
    <a-scene 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best; patternRatio: 0.8"
        renderer="logarithmicDepthBuffer: true; antialias: true; precision: high; alpha: true"
        embedded>

        <!-- 3D Cube with depth enhancement -->
        <a-box 
            position="0 0.15 -0.5"
            rotation="20 45 0"
            color="#00FF88"
            scale="0.3 0.3 0.3"
            material="shader: standard; opacity: 0.95; transparent: true; metalness: 0.7; roughness: 0.2"
            shadow="cast: true; receive: true"
            geometry=""
            animation="property: rotation; to: 20 405 0; loop: true; dur: 10000">
        </a-box>

        <!-- Enhanced lighting -->
        <a-light 
            type="hemisphere" 
            color="#FFFFFF" 
            ground-color="#444444"
            intensity="0.8">
        </a-light>
        
        <a-light 
            type="directional" 
            color="#FFFFFF"
            intensity="1.2"
            position="-1 3 1"
            cast-shadow
            shadow-map-size="2048">
        </a-light>

        <!-- Camera setup -->
        <a-entity 
            camera
            position="0 0 0"
            look-controls="enabled: false">
        </a-entity>
    </a-scene>

    <script>
        // Scene initialization checks
        const scene = document.querySelector('a-scene');
        
        scene.addEventListener('loaded', () => {
            document.querySelector('.arjs-loader').style.display = 'none';
            
            // Depth buffer verification
            const renderer = scene.renderer;
            if (!renderer.getContext().getExtension('EXT_color_buffer_float')) {
                alert('Ваше устройство не поддерживает расширенный 3D-рендеринг');
            }
        });

        // Performance optimization
        window.addEventListener('beforeunload', () => {
            const components = scene.querySelectorAll('[arjs]');
            components.forEach(comp => comp.parentNode.removeChild(comp));
        });
    </script>
</body>
</html>
